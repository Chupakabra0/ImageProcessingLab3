# Лабораторная работа №3

## Постановка задачи

Разработать программу, в которой используется фильтр согласно **варианту 7**

| Вариант | Метод фильтрации                      |
|:-------:| ------------------------------------- |
|    7    | Фильтра для создания эффекта тиснения | 

Продемонстрировать работу программы на разных фотографиях. Сделать выводы исходя из реализованного метода.

## Выполнение работы

> Тиснение — это фотофильтр, который преобразует изображение так, что фигуры внутри будут смотреться так, будто они выдавлены на металлической поверхности.

Удачным примером тиснения является любая украинская копейка, на реверсе которой выдавлен герб Украины.

Тиснение работает следующим образом:
1. Алгоритм начинает работу со стандартным полноцветным изображением.
2. Каждый пиксель обрабатывается **ядром тиснения** размером 3x3. Ядро тиснения отличается от ядра размытия и резкости тем, что сумма коэффициентов ядра равна не 1, а 0. Это означает, что "фоновым" пикселям присваиваются нулевые значения, а нефоновым — значения, отличные от нуля.
3. После обработки фото ядром тиснения, к каждому пикселю фотографии прибавляется 128. Таким образом значением фоновых пикселей станет средний серый цвет. Суммы, превышающие 255, можно или округлить до 255, или взять остаток по модулю 255. Аналогично, если сумма будет меньше 0.
4. В тиснёном варианте изображения, контуры кажутся выдавленными над поверхностью. Направление подсветки фотографии можно корректировать, меняя позиции 1 и -1 в ядре.

В примерах будут использованы две матрицы тиснения:

![Матрицы](https://latex.codecogs.com/png.image?\dpi{110}\begin{align*}&space;M_{1}&space;=&space;\begin{pmatrix}&space;&space;&space;&space;&space;&space;1&space;&&space;0&space;&&space;0&space;&space;\\&space;&space;&space;&space;&space;0&space;&&space;0&space;&&space;0&space;&space;\\&space;&space;&space;&space;&space;0&space;&&space;0&space;&&space;-1&space;\\&space;&space;&space;&space;\end{pmatrix}&space;&space;&space;&space;&&&space;M_{2}&space;=&space;\begin{pmatrix}&space;&space;&space;&space;&space;&space;0&space;&&space;0&space;&&space;0&space;&space;\\&space;&space;&space;&space;&space;0&space;&&space;1&space;&&space;0&space;&space;\\&space;&space;&space;&space;&space;0&space;&&space;0&space;&&space;-1&space;\\&space;&space;&space;&space;\end{pmatrix}\end{align*})

Также важным вопросом является решение **проблемы свёртки на краях изображения**. Игнорирование этой проблемы недопустимо, так как размер результирующей фотографии будет уменьшаться.

Наиболее простыми методами решения этой проблемы являются:
1. заполнение константой (чаще всего, используется чёрный цвет);
2. взятие ближайшего значения;
3. зеркалирование границы.

В рамках лабораторной работы использовался метод взятия ближайшего значения и заполнения чёрным цветом.

Консольное приложение, демонстрирующее фильтрацию с эффектом тиснения, было написано на языке C++ с использованием библиотеки OpenCV.

> Отметим, что код функции универсален и подходит для любого ядра. Добавление серого цвета в результирующее изображение происходит отдельно.
> ```cpp
> void UniversalTransform(const Mat& inputImage, Mat& outputImage, const Mat& transMatrix) {
>    AddEdgeClosest(inputImage, outputImage, transMatrix.rows / 2 - (transMatrix.cols % 2 == 0));
>    const auto tempImage = outputImage.clone();
>
>    for (auto i = 1; i < outputImage.rows - 1; ++i) {
>        for (auto j = 1; j < outputImage.cols - 1; ++j) {
>            auto& curr = outputImage.at<Vec3b>(i, j);
>            curr = 0;
>
>            for (auto k = 0; k < transMatrix.rows; ++k) {
>                for (auto l = 0; l < transMatrix.cols; ++l) {
>                    for (auto m = 0; m < 3; ++m) {
>                        curr[m] += static_cast<uchar>(transMatrix.at<double>(k, l)
>                            * static_cast<double>(tempImage.at<Vec3b>(i - 1 + k, j - 1 + l)[m]));
 >                   }
 >               }
 >           }
 >       }
 >   }
>}
>```


## Пример работы программы

Консольное приложение на вход принимает два аргумента: один обязательный — `--filename`, который определяет путь входного файла, и один опциональный — `--grey`, который позволяет добавить серый цвет в результирующее изображение.

> Приложение:
> 
> ![Приложение](https://i.ibb.co/bBP6MTz/1.png)
> 
> Входное изоборажение:
> 
> ![Входное изображение](https://i.ibb.co/SBCc6k3/2.png)
> 
> Результирующее изображение с использованием ядра M_1:
> 
> ![M_1](https://i.ibb.co/RNvWdFg/3.png)
> 
> Результирующее изображение с использованием ядра M_2:

> ![M_2](https://i.ibb.co/Mpxj72g/4.png) 


## Выводы

Было разработано программное обеспечение для фильтрации фотографии при помощи ядра тиснения, рассмотрен принцип работы операции свёртки изображения, а также рассмотрены основные отличия ядер тиснения и ядер размытия и резкости.

Кроме того, изучены и реализованы различные способы решения проблемы свёртки на краях изображения и универсальный метод применения практически любого ядра на изображение.
